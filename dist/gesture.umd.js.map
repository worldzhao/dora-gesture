{"version":3,"file":"gesture.umd.js","sources":["../src/utils.ts","../src/gesture.ts"],"sourcesContent":["import { IVector } from \"./types\";\n\n/**\n * 计算向量的模（两指触摸 两指距离）\n * @param v 向量\n */\nexport function calcLen(v: IVector) {\n  return Math.sqrt(v.x * v.x + v.y * v.y);\n}\n\n/**\n * 获取两个向量之间的角度（含方向）\n * @param a 向量一\n * @param b 向量二\n */\nexport function calcAngle(a: IVector, b: IVector) {\n  const l = calcLen(a) * calcLen(b);\n  if (l) {\n    // 取得两个向量夹角的余弦值\n    const cosValue = (a.x * b.x + a.y * b.y) / l;\n    // 取得夹角度数\n    let angle = Math.acos(Math.min(cosValue, 1));\n    // 取得夹角方向（顺时针 逆时针）\n    angle = a.x * b.y - b.x * a.y > 0 ? -angle : angle;\n    return (angle * 180) / Math.PI;\n  }\n  return 0;\n}\n\n/**\n * 判断触发元素是否存在与事件元素之上（进行委托）\n * @param target 触发元素\n * @param selector 绑定事件的元素选择器\n */\nexport function isTargetOverHandler(\n  target: HTMLElement | null,\n  selector?: string\n) {\n  if (!selector) return true;\n  while (target && target.tagName.toLowerCase() !== \"body\") {\n    if (target.matches(selector)) {\n      return true;\n    }\n    // @ts-ignore\n    target = target.parentNode;\n  }\n  return false;\n}\n","import {\n  ITouch,\n  EventType,\n  IVector,\n  IMove,\n  IParams,\n  Handles,\n  Listener,\n  IUserConfig,\n  IDefaultConfig,\n  IConfig\n} from \"./types\";\nimport { isTargetOverHandler, calcLen, calcAngle } from \"./utils\";\n\nconst defaultConfig: IDefaultConfig = {\n  selector: \"\",\n  longTapTime: 750, // 长按持续时间\n  bufferDistance: 30 // 划动缓冲距离\n};\n\nclass Gesture {\n  // 目标元素\n  private target: HTMLElement | null;\n  // 配置信息\n  private config: IConfig;\n  // 委托元素选择器\n  private selector?: string;\n  // 触发长按的定时器\n  private longtapTimeout: NodeJS.Timeout | null = null;\n  // 触发点按的定时器\n  private tapTimeout: NodeJS.Timeout | null = null;\n  // 是否执行双击\n  private shouldDoubleTap: boolean = false;\n  // 上一次双指触摸的向量\n  private preVector: IVector = { x: 0, y: 0 };\n  // 双指触摸 双指距离\n  private fingerDistance: number = 0;\n  // 上一次触摸的信息\n  private preTouchInfo: ITouch = { x: 0, y: 0, time: 0 };\n  // 本次触摸信息\n  private currentTouchInfo: ITouch = { x: 0, y: 0, time: 0 };\n  // 移动过程中变化的位置参数\n  private preMoveInfo: IMove = { x: 0, y: 0 };\n  // 存放订阅函数的对象\n  private handles: Handles = {};\n  // 订阅函数参数\n  private params: IParams = {\n    direction: undefined,\n    diffX: 0,\n    diffY: 0,\n    deltaX: 0,\n    deltaY: 0,\n    zoom: 1,\n    angle: 0\n  };\n  // 当前触摸元素\n  private e: HTMLElement | null = null;\n\n  constructor(config: IUserConfig) {\n    this.config = { ...defaultConfig, ...config };\n    const { target, selector } = this.config;\n\n    if (\n      !target ||\n      (!(target instanceof HTMLElement) && typeof target !== \"string\")\n    ) {\n      throw new Error(\"Target must be HTMLElement or string!\");\n    }\n\n    this.target =\n      target instanceof HTMLElement ? target : document.querySelector(target);\n\n    if (this.target === null) throw new Error(\"Target must be existed!\");\n\n    this.selector = selector;\n\n    // 绑定事件\n    this.touch = this.touch.bind(this);\n    this.move = this.move.bind(this);\n    this.end = this.end.bind(this);\n    this.cancel = this.cancel.bind(this);\n\n    this.target.addEventListener(\"touchstart\", this.touch, false);\n    this.target.addEventListener(\"touchmove\", this.move, false);\n    this.target.addEventListener(\"touchend\", this.end, false);\n    this.target.addEventListener(\"touchcancel\", this.cancel, false);\n  }\n\n  private reset() {\n    this.currentTouchInfo = { x: 0, y: 0, time: 0 };\n    this.preMoveInfo = { x: 0, y: 0 };\n    this.params = {\n      direction: undefined,\n      diffX: 0,\n      diffY: 0,\n      deltaX: 0,\n      deltaY: 0,\n      zoom: 1,\n      angle: 0\n    };\n  }\n\n  private touch(e: TouchEvent) {\n    this.emit(\"touch\", e);\n    this.e = e.target as HTMLElement;\n    const point = e.touches[0];\n    const now = Date.now();\n\n    this.currentTouchInfo = { x: point.pageX, y: point.pageY, time: now };\n\n    this.longtapTimeout && clearTimeout(this.longtapTimeout);\n    this.tapTimeout && clearTimeout(this.tapTimeout);\n    this.shouldDoubleTap = false;\n\n    // 多个手指触摸\n    if (e.touches.length > 1) {\n      // 获取第二个手指信息\n      const point2 = e.touches[1];\n\n      // 存储向量信息\n      this.preVector = {\n        x: point2.pageX - this.currentTouchInfo.x,\n        y: point2.pageY - this.currentTouchInfo.y\n      };\n\n      // 两指距离\n      this.fingerDistance = calcLen(this.preVector);\n      this.emit(\"multitouch\", e);\n    } else {\n      // 单个手指触摸\n      // 手指触摸后立即开启长按定时器\n      this.longtapTimeout = setTimeout(() => {\n        this.emit(\"longtap\", e);\n        // 长按处罚后dbtap的标识置为false 避免非首次长按后又触发双击事件\n        this.shouldDoubleTap = false;\n        e.preventDefault();\n      }, this.config.longTapTime);\n\n      // 判断是否处于双击状态\n      this.shouldDoubleTap = Boolean(\n        this.preTouchInfo.time &&\n          Math.abs(this.currentTouchInfo.time - this.preTouchInfo.time) < 300 &&\n          Math.abs(this.currentTouchInfo.x - this.preTouchInfo.x) < 30 &&\n          Math.abs(this.currentTouchInfo.y - this.preTouchInfo.y) < 30\n      );\n\n      // 更新上一次触摸信息为当前触摸信息，供下一次触摸使用\n      this.preTouchInfo = { ...this.currentTouchInfo };\n    }\n  }\n\n  private move(e: TouchEvent) {\n    // 执行原生的touchmove事件回调\n    this.emit(\"move\", e);\n\n    const point = e.touches[0];\n    // 多个手指触摸的情况\n    if (e.touches.length > 1) {\n      const point2 = e.touches[1];\n      // 滑动过程中的当前向量\n      const currentVector: IVector = {\n        x: point2.pageX - point.pageX,\n        y: point2.pageY - point.pageY\n      };\n      this.emit(\"multimove\", e);\n      if (this.preVector.x) {\n        if (this.fingerDistance) {\n          this.params.zoom = calcLen(currentVector) / this.fingerDistance; // 利用前后向量模比计算放大或缩小的倍数\n          this.emit(\"pinch\", e); // 执行pinch手势\n        }\n        this.params.angle = calcAngle(currentVector, this.preVector); // 计算角度\n        this.emit(\"rotate\", e); // 执行旋转手势\n      }\n      // 更新上一个向量为当前向量\n      this.preVector = { ...currentVector };\n    } else {\n      // 与手指刚触摸时的相对坐标\n      const diffX = point.pageX - this.currentTouchInfo.x;\n      const diffY = point.pageY - this.currentTouchInfo.y;\n      this.params.diffX = diffX;\n      this.params.diffY = diffY;\n\n      if (this.preMoveInfo.x) {\n        // 记录移动过程中与上一次移动的相对坐标\n        this.params.deltaX = point.pageX - this.preMoveInfo.x;\n        this.params.deltaY = point.pageY - this.preMoveInfo.y;\n      }\n\n      // 当手指划过的距离超过了30\n      if (\n        Math.abs(diffX) > this.config.bufferDistance ||\n        Math.abs(diffY) > this.config.bufferDistance\n      ) {\n        // 所有单指非滑动事件取消\n        this.longtapTimeout && clearTimeout(this.longtapTimeout);\n        this.tapTimeout && clearTimeout(this.tapTimeout);\n        this.shouldDoubleTap = false;\n      }\n\n      this.emit(\"slide\", e); // 执行自定义的move回调\n\n      // 更新移动中的手指参数\n      this.preMoveInfo = { x: point.pageX, y: point.pageY };\n    }\n  }\n\n  private end(e: TouchEvent) {\n    // 执行原生的touchend事件\n    this.emit(\"end\", e);\n\n    // 手指离开了 取消长按事件\n    this.longtapTimeout && clearTimeout(this.longtapTimeout);\n    const now = Date.now();\n\n    // 最后一次触摸点距离起始点的距离\n    const diffX = ~~(this.preMoveInfo.x - this.currentTouchInfo.x);\n    const diffY = ~~(this.preMoveInfo.y - this.currentTouchInfo.y);\n\n    // 存在位移（移动距离大于30）\n    if (\n      (this.preMoveInfo.x && Math.abs(diffX) > this.config.bufferDistance) ||\n      (this.preMoveInfo.y && Math.abs(diffY) > this.config.bufferDistance)\n    ) {\n      // Y轴移动距离较大\n      if (Math.abs(diffX) < Math.abs(diffY)) {\n        if (diffY < 0) {\n          // 上划\n          this.params.direction = \"up\";\n          this.emit(\"swipeUp\", e);\n        } else {\n          // 下划\n          this.params.direction = \"down\";\n          this.emit(\"swipeDown\", e);\n        }\n      } else {\n        // X轴移动距离较大\n        if (diffX < 0) {\n          // 左划\n          this.params.direction = \"left\";\n          this.emit(\"swipeLeft\", e);\n        } else {\n          // 右划\n          this.params.direction = \"right\";\n          this.emit(\"swipeRight\", e);\n        }\n      }\n      this.emit(\"swipe\", e); // 划\n    } else {\n      // 单次点击 300ms内离开 触发点击事件\n      if (!this.shouldDoubleTap && now - this.currentTouchInfo.time < 300) {\n        this.tapTimeout = setTimeout(() => {\n          this.emit(\"tap\", e);\n          // 事件处理完的回调\n          this.emit(\"finish\", e);\n        }, 300);\n      } else if (this.shouldDoubleTap) {\n        // 300ms内再次点击且离开，触发双击事件 取消上次单击事件\n        this.emit(\"dbtap\", e);\n        this.tapTimeout && clearTimeout(this.tapTimeout);\n        this.emit(\"finish\", e);\n      } else {\n        this.emit(\"finish\", e);\n      }\n    }\n    this.reset();\n    this.preVector = { x: 0, y: 0 }; //重置上一个向量的坐标\n  }\n\n  private cancel(e: TouchEvent) {\n    this.emit(\"cancel\", e);\n  }\n\n  /**\n   * 触发事件\n   */\n  private emit(type: EventType, e: TouchEvent) {\n    if (typeof this.handles[type] === \"undefined\") {\n      this.handles[type] = [];\n    }\n    // 只有触发事件的元素在委托元素上才执行\n    if (isTargetOverHandler(this.e, this.selector)) {\n      for (let i = 0, len = this.handles[type]!.length; i < len; i++) {\n        const listener = this.handles[type]![i];\n        listener(e, this.params);\n      }\n    }\n  }\n\n  /**\n   * 订阅事件\n   */\n  public on(type: EventType, listener: Listener) {\n    if (typeof listener !== \"function\")\n      throw new Error(\"Listener must be Function type!\");\n    if (typeof this.handles[type] === \"undefined\") {\n      this.handles[type] = [];\n    }\n    this.handles[type]!.push(listener);\n    return this;\n  }\n\n  /**\n   * 取消订阅\n   */\n  public off(type: EventType) {\n    this.handles[type] = [];\n  }\n\n  public destroy() {\n    this.longtapTimeout && clearTimeout(this.longtapTimeout);\n    this.tapTimeout && clearTimeout(this.tapTimeout);\n    if (this.target) {\n      this.target.removeEventListener(\"touchstart\", this.touch);\n      this.target.removeEventListener(\"touchmove\", this.move);\n      this.target.removeEventListener(\"touchend\", this.end);\n      this.target.removeEventListener(\"touchcancel\", this.cancel);\n    }\n  }\n}\n\nexport default Gesture;\n"],"names":[],"mappings":"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"}